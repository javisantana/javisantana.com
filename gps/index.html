<!doctype html>
<html lang=en>
  <head>
  <meta charset=utf-8>
  <title>tracker</title>
    <style>
      html {
        font-family: Helvetica;
        padding: 20px;
      }
      .button {
        padding: 20px 30px;
        background: #333;
        color: white;
        font-weight: bold;
        font-size: 1.5em;
        text-transform:uppercase;
      }
    </style>
  </head>
<body>
  <a id="start_btn" class="button">start</a>
  <script>
      // https://stackoverflow.com/questions/59471449/how-to-prevent-screen-sleep-using-javascript
      function keepScreenAwake() {
        // Create the root video element
        var video = document.createElement('video');
        video.setAttribute('loop', '');
        // Add some styles if needed
        video.setAttribute('style', 'position: fixed;');

        // A helper to add sources to video
        function addSourceToVideo(element, type, dataURI) {
            var source = document.createElement('source');
            source.src = dataURI;
            source.type = 'video/' + type;
            element.appendChild(source);
        }

        // A helper to concat base64
        var base64 = function(mimeType, base64) {
            return 'data:' + mimeType + ';base64,' + base64;
        };

        // Add Fake sourced
        addSourceToVideo(video,'webm', base64('video/webm', 'GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA='));
        addSourceToVideo(video, 'mp4', base64('video/mp4', 'AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=='));

        // Append the video to where ever you need
        document.body.appendChild(video);

        // Start playing video after any user interaction.
        // NOTE: Running video.play() handler without a user action may be blocked by browser.
        var playFn = function() {
            video.play();
            document.body.removeEventListener('touchend', playFn);
            const options = {
              enableHighAccuracy: true,
              maximumAge: 30000,
              timeout: 27000
            };
            function printPos(p) {
              console.log(p);
              document.body.append(
                `${p.timestamp},${p.coords.latitude},${p.coords.latitude}, ${p.coords.altitude},${p.coords.speed}`
              )
            }
            const watchID = navigator.geolocation.watchPosition(printPos, (e) => console.log(e), options);
            //setInterval(() => { }, 1000)
            navigator.geolocation.getCurrentPosition(printPos, (e) => console.log(e), options);
            document.getElementById('start_btn').style.display = 'none';
        }
          
        document.body.addEventListener('touchend', playFn);
      }
      keepScreenAwake();
  </script>
</body>
</html>
